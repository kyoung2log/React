`created at 25.02.24`

### 1. 가상 DOM 소개

- 가상 DOM이란 실제 DOM을 자바스크립트 객체로 모델링한 것
- 실제 DOM을 변경시키는 작업은 비용이 많이 소모되기 때문에 가상 DOM을 변경시킨 뒤 최소한의 변경 사항만 실제 DOM에 적용

### 2. 실제 DOM

- 실제 DOM은 HTML 문서를 크고 복잡한 객체로 모델링 한 것
- `querySelector` 나 `getElementById` 등의 함수를 사용해 실제 DOM을 조작할 수 있는데, 문서가 크고 복잡할수록 엘리먼트 탐색 속도가 느려짐
  - `querySelector`
    - CSS 선택자를 인수로 받아 선택자와 일치하는 첫 엘리먼트 객체를 반환
    - 모든 선택자를 완전 탐색하므로 `O(n)`에 수행 가능
    - 만약 선택자가 복잡한 경우 추가적인 시간이 더 든다.
      - ex) 선택자가 `div span.someClass`인 경우, 전체 돔을 탐색하면서 모든 `div`를 찾고, 찾은 `div`를 완전 탐색하면서 모든 `span`을 찾고, 찾은 `span`을 완전 탐색하면서 모든 `.someClass`를 찾는다.
    - 클래스 이름이 동일한 여러 엘리먼트를 선택할 때 적합
  - `getElementById`
    - ID를 인수로 받아 ID명이 일치하는 엘리먼트 객체를 반환
    - 최신브라우저에서 ID-엘리먼트 매핑 해싱 메커니즘은 효율적이기에 `O(1)`에 수행 가능
    - 다만 ID는 고유해야 하기 때문에 여러번 재사용되는 컴포넌트에서 사용하기 적합하지 않음
- 실제 DOM은 다음과 같은 문제를 가짐
  - 성능
    - `리플로우 → 리페인팅`의 과정이 UI 지연을 유발 → 안좋은 UX
    - [몇 밀리초를 절약하는 것으로도 수백만 달러를 만들 수 있음](https://web.dev/case-studies/milliseconds-make-millions?hl=ko)
  - 브라우저 간 호환성
    - 브라우저마다 문서 모델링 방식이 달라 웹 애플리케이션의 일관성이 보장되지 않음
    - 리액트는 자체적으로 구현한 합성 이벤트 시스템(래퍼객체)이라는 것을 사용해 이 문제를 해결
      - 모든 브라우저에 일관된 방법으로 이벤트화 상호작용을 할 수 있음
      - 이벤트 위임를 통해 루트에서 이벤트 리스너를 추가함
- 문서 조각
  - 부모를 가지지 않는 문서 객체로 DOM의 일부가 아니기 때문에 리플로우를 발생시키지 않음
  - 실제 DOM을 조작하는 것은 비용이 많이 소모되기 때문에 문서 조각을 통해 성능을 개선
  - 문서 조각은 가상 DOM과 비슷하게 여러개의 변경사항을 일괄적으로 처리

### 3. 가상 DOM 작동 방식

- 리액트는 `React.createElement`를 사용해 엘리먼트 객체를 생성함
- 생성된 엘리먼트 객체는 아래와 같은 속성을 포함함
  - **`$$typeof`**
    - 객체가 유효한 리액트 엘리먼트인지 확인할 때 사용되는 심벌(식별자)
    - `Symbol(react.fragment)`
      - 여러 자식 엘리먼트를 그룹화하여 단일 부모 엘리먼트로 반환됨
      - 추가적인 DOM 노드를 생성하지 않고 자식 엘리먼트를 그룹화함
    - `Symbol(react.portal)`
      - 기존 DOM 트리 외부의 DOM 노드로 자식 엘리먼트를 렌더링함
      - 모달, 툴팁, 드롭다운 같은 UI에 사용
    - `Symbol(react.profiler)`
      - 애플리케이션의 성능을 분석하고 최적화하는 도구
      - 렌더링 과정에서 각 컴포넌트가 얼마나 자주, 얼마나 오래 되었는지 측정하는 도구
      - 성능 병목 지점을 파악하고 불필요한 렌더링을 줄일 수 있음
    - `Symbol(react.provider)`
      - 리액트 컨텍스트를 통해 하위 컴포넌트에 데이터를 전달함
      - 전역 상태관리를 위해 사용되며 컨텍스트의 값을 변경하면 모든 하위 컴포넌트가 재렌더링됨
  - `type`
    - 엘리먼트가 나타내는 컴포넌트의 종류로 태그이름의 문자열이거나 함수
  - `ref`
    - DOM을 직접 조작해야 하는 경우 사용되는 속성
  - `props`
    - 컴포넌트에 전달된 모든 속성과 프롭을 포함하는 객체
  - `_owner` / `_store`
    - 앨리먼트를 생성한 컴포넌트를 추적하기 위해 사용되는 속성
    - 앨리먼트 상태와 콘텍스트의 여러 측면을 추적할 때 사용되는 속성
    - 리액트 내부 구현사항으로 애플리케이션 코드에서 접근하면 안됨
- 가상 DOM과 실제 DOM의 비교
  - 가상 DOM과 실제 DOM은 비슷한 방식으로 동작함
    - 가상 DOM : React.createElement로 엘리먼트 생성
    - 실제 DOM : document.createElement로 DOM노드 생성
  - 다만 리액트는 diffing 알고리즘을 사용하는 재조정 프로세스를 가짐
  - Diffing 알고리즘 동작 방식
    - 두 트리의 루트에 있는 노드가 다른 경우, 리액트는 기존 트리 전체를 새 트리로 대체함
    - 루트 노드가 동일하다면, 리액트는 노드의 속성이 변경된 경우에만 업데이트 함
    - 자식 노드가 다른 경우 리액트는 변경된 자식 노드만 업데이트 함
    - 노드의 자식들이 동일하지만 순서가 변경된 경우, 노드 순서만 재설정함
    - 트리에서 노드가 제거되면 리액트는 실제 DOM에서 노드를 제거함
    - 트리에 새 노드가 추가되면 리액트는 실제 DOM에 노드를 추가함
    - 노드의 종류가 변경된 경우 리액트는 이전 노드를 제거하고 새 노드를 생성함
    - 노드에 key 프롭이 있다면 리액트는 key 프롭을 사용해 노드의 교체가 필요한지 확인함

### 🎊 복습하기

1. **DOM이란 무엇이며, 가상 DOM과 어떻게 다른가요 ?**
   - DOM은 웹 어플리케이션이 어떻게 구성되어 있는지 나타내는 문서 객체 모델
   - 가상 DOM은 실제 DOM을 추상화한 자바스크립트 객체
2. **문서 조각이란 무엇이며, 리액트의 가상 DOM과 어떤 점에서 비슷하고 다른가요 ?**
   - 문서조각이란 웹 api를 통해 생성할 수 있는 문서 조각 객체로, 실제 DOM 트리의 일부가 아니라 리플로우를 트리거하지 않는다.
   - 리플로우를 트리거하지 않기 때문에 DOM의 변경사항들을 문서 조각에서 일괄적으로 적용한다는 점이 가상DOM과 비슷함
   - 이 때 가상DOM은 디핑알고리즘을 사용해 변경된 사항을 효율적으로 찾아내는 반면, 문서 조각은 변경된 요소를 포함한 내용을 적용하는 방식
3. **DOM에서 문제가 되는 사안은 무엇인가요?**
   - 문서가 커질수록 리플로우/리페인팅에 비용이 많이 소모되어 UI가 지연될 가능성이 높다
4. **사용자 인터페이스를 더 빠르게 업데이트하는데, 가상 DOM이 어떻게 활용되나요 ?**
   - 가상 DOM의 디핑 알고리즘이 변경 사항을 빠르게 찾아내 일괄적으로 적용하는 재조정 알고리즘을 활용한다.
   - 모든 UI를 다시 그릴 필요 없이 변경된 부분만 감지하여 빠르게 업데이트 가능
5. **리액트의 렌더링은 어떻게 작동하나요 ? 이로 인해 잠재되었던 어떤 문제가 발생할 수 있나요 ?**
   - 상태나 props에 변경이 감지될 때마다 자식 컴포넌트를 리렌더링 한다.
   - 자식요소가 정적인 경우에도 렌더링이 되는 문제가 있을 수 있어 적절한 메모이제이션이 필요
